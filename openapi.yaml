openapi: 3.0.0
info:
  license:
    name: UNKNOWN
    url: https://choosealicense.com/no-permission/
  title: Roster Scheduler Backend API
  version: 0.0.4
  description: API for submitting and managing roster scheduling jobs.
servers:
  - url: http://localhost:8080
security:
  - BearerAuth: []
paths:
  /api/v1/roster:
    post:
      operationId: submitRoster
      summary: Create a new roster
      description: Create a new roster with an initial revision.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterSubmission"
      responses:
        "201":
          description: Roster created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterCreatedResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /api/v1/roster/{id}:
    get:
      operationId: getRoster
      summary: Get roster details
      description: Retrieve a roster by its ID.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the roster.
      responses:
        "200":
          description: Roster found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    put:
      operationId: updateRoster
      summary: Update a roster
      description: Update the name of a roster by its ID.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the roster.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterSubmission"
      responses:
        "200":
          description: Roster updated successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /api/v1/roster/{id}/revision:
    post:
      operationId: submitRosterRevision
      summary: Create a new roster revision
      description: Create a new revision for a roster with the provided parameters.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the roster.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterRevisionSubmission"
      responses:
        "201":
          description: Roster revision created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterRevisionCreatedResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    get:
      operationId: listRosterRevisions
      summary: List roster revisions
      description: Retrieve all revisions for a given roster ID.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the roster.
      responses:
        "200":
          description: List of revisions for the roster
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RosterRevisionListItemResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /api/v1/roster/{id}/revision/{revisionNumber}:
    get:
      tags: [Solver] # Indicates this endpoint is part of a group of endpoints used by the solver.
      operationId: getRosterRevision
      summary: Get roster revision details
      description: Retrieve a specific revision of a roster by roster ID and revision number.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the roster.
        - name: revisionNumber
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Revision number of the roster revision.
      responses:
        "200":
          description: Roster revision found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterRevisionResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    put:
      operationId: updateRosterRevision
      summary: Update a roster revision
      description: Update the parameters of a roster revision by roster ID and revision number.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the roster.
        - name: revisionNumber
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Revision number of the roster revision.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterRevisionSubmission"
      responses:
        "200":
          description: Roster revision updated successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    patch:
      operationId: patchRosterRevision
      summary: Partially update a roster revision
      description: Partially update a roster revision by roster ID and revision number. Only the fields provided in the request body will be updated.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the roster.
        - name: revisionNumber
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Revision number of the roster revision.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterParameters"
      responses:
        "200":
          description: Roster revision updated successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /api/v1/solution:
    post:
      tags: [Solver] # Indicates this endpoint is part of a group of endpoints used by the solver.
      operationId: submitSolution
      summary: Submit a solution for a roster
      description: Submit a solution for a given roster configuration.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SolutionSubmission"
      responses:
        "201":
          description: Solution submitted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SolutionCreatedResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /api/v1/solution/{id}:
    get:
      operationId: getSolution
      summary: Get a solution by ID
      description: Retrieve a solution for a given solution ID.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the solution.
      responses:
        "200":
          description: Solution found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SolutionResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Solution not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /api/v1/roster/{id}/revision/{revisionNumber}/solve:
    post:
      operationId: solveRosterRevision
      summary: Trigger solving a roster revision
      description: Start the solve process for a specific roster revision by roster ID and revision number.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the roster.
        - name: revisionNumber
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Revision number of the roster revision.
      responses:
        "202":
          description: Solve process started
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /api/v1/roster/{id}/revision/{revisionNumber}/solutions:
    get:
      operationId: listSolutions
      summary: List solutions for a roster revision
      description: Retrieve all solutions associated with a given roster revision.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Unique identifier for the roster.
        - name: revisionNumber
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: Revision number of the roster revision.
      responses:
        "200":
          description: List of solutions for the specified roster revision
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SolutionListItemResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /healthz:
    get:
      operationId: healthCheck
      summary: Health check
      description: Returns 200 if the service is healthy.
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                properties:
                  status:
                    type: string
                    example: ok
        "503":
          description: Service is unhealthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: unhealthy
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    RosterSubmission:
      type: object
      properties:
        name:
          type: string
          description: The name of the roster.
    RosterRevisionSubmission:
      type: object
      required:
        - parameters
      properties:
        parameters:
          $ref: "#/components/schemas/RosterParameters"
          description: The parameters for the roster revision.
    RosterParameters:
      type: object
      # Note that no fields are required here as the client can send a work-in-progress
      # roster that will only be partially filled out.
      properties:
        doctors:
          type: array
          items:
            type: string
          description: The names of all doctors.
        num_days:
          type: integer
          minimum: 1
          description: The number of days to schedule.
        start_date:
          type: string
          format: date
          description: The start date of the schedule.
        doctors_per_shift_override:
          type: object
          description: Mapping from day index (as string) to a map of shift name to number of doctors required for each shift.
          additionalProperties:
            type: object
            additionalProperties:
              type: integer
              description: Number of doctors required for the shift.
        doctors_per_shift_default:
          type: object
          description: Default number of doctors for each shift if not specified for a day.
          additionalProperties:
            type: integer
        shifts:
          type: array
          items:
            type: string
          description: The names of the shifts in a day.
        balance_overtime:
          type: boolean
          description: Whether to balance overtime hours across doctors.
        unavailable_slots:
          type: object
          description: Mapping of shift name to doctor name to list of days the doctor is unavailable.
          additionalProperties:
            type: object
            additionalProperties:
              type: array
              items:
                type: integer
        leave_days:
          type: object
          description: Mapping of doctor name to days the doctor is on leave.
          additionalProperties:
            type: array
            items:
              type: integer
        known_assignments:
          type: object
          description: Mapping of doctor name to a map of shift name to list of days the doctor is assigned to that shift.
          additionalProperties:
            type: object
            additionalProperties:
              type: array
              items:
                type: integer
              description: List of days the doctor is assigned to the shift.
        shift_hours:
          type: object
          description: Mapping from shift name (e.g. 'day', 'night') to a dict of days of the week/default ('monday', 'tuesday') to a dict of regular/overtime hours.
          additionalProperties:
            type: object
            additionalProperties:
              $ref: "#/components/schemas/Hours"
        regular_hours:
          type: object
          description: Default regular hours for each day of the week with a default.
          additionalProperties:
            type: integer
        override_regular_hours:
          type: object
          description: Override regular hours for specific days.
          additionalProperties:
            type: integer
        override_shift_hours:
          type: object
          description: Mapping from day of the month index to shift name (e.g. 'day', 'night') to a dict or regular/overtime hours.
          additionalProperties:
            type: object
            additionalProperties:
              $ref: "#/components/schemas/Hours"
        overtime_multiplier:
          type: number
          minimum: 0
          description: Multiplier for overtime hours.
        minimum_days_post_shift:
          type: integer
          minimum: 1
          description: The minimum number of days a doctor must have off after doing a shift.
        minimum_golden_weekends:
          type: integer
          minimum: 0
          description: Minimum number of golden weekends (weekends with no shifts) a doctor should have.
        maximum_golden_weekends:
          type: integer
          minimum: 0
          description: Maximum number of golden weekends (weekends with no shifts) a doctor can have. If 0, no maximum is enforced.
        balance_day_night:
          type: boolean
          description: Whether to balance day and night shifts.
        balance_weekend_shifts:
          type: boolean
          description: Whether to balance weekend shifts.
        post_call:
          type: object
          description: Mapping of shift names to whether they provide post-call (i.e. getting the next day off).
          additionalProperties:
            type: boolean
        minimum_overtime_hours:
          type: integer
          minimum: 0
          description: Minimum overtime hours a doctor should work.
        minimum_regular_hours:
          type: integer
          minimum: 0
          description: Minimum regular hours a doctor should work.
        groups:
          type: object
          description: Mapping of group name to list of doctor names in that group. Used to prevent group members from working the same day.
          additionalProperties:
            type: array
            items:
              type: string
        restrict_groups_overlap_per_weekday:
          type: array
          items:
            type: string
          description: List of days names for which to restrict group overlap.
        groups_unavailable_slots:
          type: object
          description: Mapping of group name to a dict with keys of shift names, indicating unavailable slots for the group.
          additionalProperties:
            type: object
            additionalProperties:
              type: array
              items:
                type: integer
        minimum_shifts_per_doctor:
          type: object
          description: Mapping of doctor name to minimum number of shifts that doctor should work. If not specified, defaults to 0.
          additionalProperties:
            type: integer
        maximum_shifts_per_doctor:
          type: object
          description: Mapping of doctor name to maximum number of shifts that doctor can work. If not specified, there is no maximum.
          additionalProperties:
            type: integer
        groups_allowed_days:
          type: object
          description: Mapping of group name to list of days that group is allowed to work.
          additionalProperties:
            type: array
            items:
              type: integer
        maximum_shifts:
          type: integer
          description: Maximum number of shifts that can be assigned to any doctor.
        golden_weekends_ignore_leave:
          type: boolean
          description: Whether to ignore leave days when calculating golden weekends.
    RosterCreatedResponse:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
          format: int32
          description: Unique identifier for the created roster.
        revision_number:
          type: integer
          format: int32
          description: Revision number of the initial revision if parameters were provided.
    RosterResponse:
      type: object
      required:
        - id
        - name
        - createdAt
      properties:
        id:
          type: integer
          format: int32
          description: Unique identifier for the roster.
        name:
          type: string
          description: The name of the roster.
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the roster was created.
    RosterRevisionCreatedResponse:
      type: object
      required:
        - revision_number
      properties:
        revision_number:
          type: integer
          format: int32
          description: Revision number for the created roster revision.
    RosterRevisionResponse:
      type: object
      required:
        - roster_id
        - revision_number
        - parameters
        - createdAt
      properties:
        roster_id:
          type: integer
          format: int32
          description: Unique identifier for the roster.
        revision_number:
          type: integer
          format: int32
          description: Revision number of this revision.
        parameters:
          $ref: "#/components/schemas/RosterParameters"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the roster revision was created.
    RosterRevisionListItemResponse:
      type: object
      required:
        - roster_id
        - revision_number
        - createdAt
      properties:
        roster_id:
          type: integer
          format: int32
          description: Unique identifier for the roster.
        revision_number:
          type: integer
          format: int32
          description: Revision number of this revision.
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the roster revision was created.
    ErrorResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Error message
    Hours:
      type: object
      required:
        - regular
        - overtime
      properties:
        regular:
          type: integer
        overtime:
          type: integer
    SolutionStatus:
      type: string
      description: The status of the solution.
      enum:
        - solved
        - infeasible
        - error
        - timed_out
    SolutionSubmission:
      type: object
      required:
        - roster_id
        - revision_number
        - solution
        - status
      properties:
        roster_id:
          type: integer
          format: int32
          description: The ID of the roster this solution is for.
        revision_number:
          type: integer
          format: int32
          description: The revision number of the roster revision this solution is for.
        solution:
          type: array
          items:
            type: array
            items:
              type: integer
          description: The solution matrix.
        status:
          $ref: "#/components/schemas/SolutionStatus"
    SolutionCreatedResponse:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
          format: int32
          description: Unique identifier for the created solution.
    SolutionResponse:
      type: object
      required:
        - id
        - roster_id
        - revision_number
        - solution
        - status
        - createdAt
      properties:
        id:
          type: integer
          format: int32
          description: Unique identifier for the solution.
        roster_id:
          type: integer
          format: int32
          description: The ID of the roster this solution is for.
        revision_number:
          type: integer
          format: int32
          description: The revision number of the roster revision this solution is for.
        solution:
          type: array
          items:
            type: array
            items:
              type: integer
          description: The solution matrix.
        status:
          $ref: "#/components/schemas/SolutionStatus"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the solution was created.
    SolutionListItemResponse:
      type: object
      required:
        - id
        - roster_id
        - revision_number
        - status
        - createdAt
      properties:
        id:
          type: integer
          format: int32
          description: Unique identifier for the solution.
        roster_id:
          type: integer
          format: int32
          description: The ID of the roster this solution is for.
        revision_number:
          type: integer
          format: int32
          description: The revision number of the roster revision this solution is for.
        status:
          $ref: "#/components/schemas/SolutionStatus"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the solution was created.
