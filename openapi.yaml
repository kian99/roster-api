openapi: 3.0.0
info:
  license:
    name: UNKNOWN
    url: https://choosealicense.com/no-permission/
  title: Roster Scheduler Backend API
  version: 0.0.40
  description: API for creating and managing roster scheduling jobs.
paths:
  /v1/rosters:
    get:
      operationId: listRosters
      summary: List all rosters
      description: Retrieve a list of all rosters.
      parameters:
        - name: sortBy
          in: query
          required: false
          schema:
            type: string
            enum: [created_date, name]
            default: created_date
          description: Field to sort by. Options are 'created_date' (roster creation timestamp) or 'name' (roster display name).
        - $ref: "#/components/parameters/SortOrderParam"
        - name: name
          in: query
          required: false
          schema:
            type: string
            maxLength: 100
          description: Filter rosters by name (case-insensitive partial match).
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/SizeParam"
      responses:
        "200":
          description: List of rosters with metadata
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterListResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    post:
      operationId: createRoster
      summary: Create a new roster
      description: Create a new roster with an initial revision.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterSubmission"
      responses:
        "201":
          description: Roster created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterCreatedResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /v1/rosters/{id}:
    get:
      operationId: getRoster
      summary: Get roster details
      description: Retrieve a roster by its ID.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
      responses:
        "200":
          description: Roster found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    put:
      operationId: updateRoster
      summary: Update a roster
      description: Update the name of a roster by its ID.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterSubmission"
      responses:
        "200":
          description: Roster updated successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    delete:
      operationId: deleteRoster
      summary: Delete a roster
      description: |
        Delete a roster by its ID.
        Deletion is cascading and will remove any child resources (e.g. revisions, solutions, and related data).
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
      responses:
        "204":
          description: Roster deleted successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /v1/rosters/{id}/revisions:
    post:
      operationId: createRosterRevision
      summary: Create a new roster revision
      description: Create a new revision for a roster with the provided parameters.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterRevisionSubmission"
      responses:
        "201":
          description: Roster revision created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterRevisionCreatedResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    get:
      operationId: listRosterRevisions
      summary: List roster revisions
      description: Retrieve all revisions for a given roster ID.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - name: sortBy
          in: query
          required: false
          schema:
            type: string
            enum: [created_date]
            default: created_date
          description: Field to sort by. Currently only 'created_date' (revision creation timestamp) is supported.
        - $ref: "#/components/parameters/SortOrderParam"
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/SizeParam"
      responses:
        "200":
          description: List of revisions for the roster
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterRevisionsListResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /v1/rosters/{id}/{roster_revision}:
    get:
      tags: [Solver] # Indicates this endpoint is part of a group of endpoints used by the solver.
      operationId: getRosterRevision
      summary: Get roster revision details
      description: |
        Retrieve a specific revision of a roster by roster ID and revision number.

        Note: This returns the current (latest) parameters for the revision, which may change over time.
        If you need the exact parameters that were used for a specific solve attempt, use the
        solution-scoped parameters endpoint instead.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
      responses:
        "200":
          description: Roster revision found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RosterRevisionResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    put:
      operationId: updateRosterRevision
      summary: Update a roster revision
      description: Update the parameters of a roster revision by roster ID and revision number.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterRevisionSubmission"
      responses:
        "200":
          description: Roster revision updated successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    patch:
      operationId: patchRosterRevision
      summary: Partially update a roster revision
      description: Partially update a roster revision by roster ID and revision number. Only the fields provided in the request body will be updated.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterParameters"
      responses:
        "200":
          description: Roster revision updated successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    delete:
      operationId: deleteRosterRevision
      summary: Delete a roster revision
      description: |
        Delete a specific revision of a roster by roster ID and revision number.
        Deletion is cascading and will remove any child resources associated with this revision (e.g. solutions and related data).
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
      responses:
        "204":
          description: Roster revision deleted successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /v1/rosters/{id}/{roster_revision}/validate:
    post:
      operationId: validateRosterRevisionChanges
      summary: Validate roster revision changes
      description: Validate the impact of applying the provided parameters to the specified roster revision.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RosterParameters"
      responses:
        "200":
          description: Validation result containing proposed field changes.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidateRevisionResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /v1/rosters/{id}/{roster_revision}/solutions/{solution_revision}:
    get:
      operationId: getSolution
      summary: Get a solution by ID
      description: Retrieve a solution for a given roster revision and solution ID.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
        - $ref: "#/components/parameters/SolutionIdParam"
      responses:
        "200":
          description: Solution found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SolutionResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Solution not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    put:
      tags: [Solver] # Indicates this endpoint is part of a group of endpoints used by the solver.
      operationId: updateSolution
      summary: Update an existing solution
      description: |
        Update an existing solution with new data.
        Manual solutions allow assignment edits.
        Automatic solutions allow solve state/outcome updates from the solver and become immutable after the first completed outcome; further updates return 409.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
        - $ref: "#/components/parameters/SolutionIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SolutionUpdate"
      responses:
        "200":
          description: Solution updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SolutionResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Solution not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "409":
          description: Solution is immutable in its current state
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      operationId: deleteSolution
      summary: Delete a solution
      description: |
        Delete a solution for the given roster revision.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
        - $ref: "#/components/parameters/SolutionIdParam"
      responses:
        "204":
          description: Solution deleted successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Solution not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /v1/rosters/{id}/{roster_revision}/solutions/{solution_revision}/parameters:
    get:
      tags: [Solver] # Indicates this endpoint is part of a group of endpoints used by the solver.
      operationId: getSolutionParameters
      summary: Get solution-associated roster parameters
      description: |
        Retrieve the roster parameters snapshot that is associated with the specified solution.

        This is intended for solvers to ensure they use exactly the same parameters that were captured when
        the solution was created (e.g. when solving was triggered), even if the roster revision is edited later.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
        - $ref: "#/components/parameters/SolutionIdParam"
      responses:
        "200":
          description: Parameters snapshot found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SolutionParametersResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Solution not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /v1/rosters/{id}/{roster_revision}/solve:
    post:
      operationId: solveRosterRevision
      summary: Trigger solving a roster revision
      description: |
        Start the solve process for a specific roster revision by roster ID and revision number.

        When solving is triggered, the API creates a new automatic solution and stores a snapshot of the roster
        parameters alongside that solution. The roster revision remains editable after this call; the solver should
        fetch the solution-associated parameters snapshot when it needs a consistent view of the inputs.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
      responses:
        "201":
          description: Solve process started with pending solution created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SolutionCreatedResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /v1/rosters/{id}/{roster_revision}/solutions:
    post:
      operationId: createSolution
      summary: Create a solution for a roster revision
      description: |
        Create a solution for a given roster revision.

        For automatic solutions, the API stores a snapshot of the roster parameters alongside the created
        solution so that the solution can be interpreted consistently even if the roster revision is edited later.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ManualSolutionSubmission"
      responses:
        "201":
          description: Solution created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SolutionCreatedResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
    get:
      operationId: listSolutions
      summary: List solutions for a roster revision
      description: Retrieve all solutions associated with a given roster revision.
      parameters:
        - $ref: "#/components/parameters/RosterIdParam"
        - $ref: "#/components/parameters/RevisionIdParam"
      responses:
        "200":
          description: List of solutions for the specified roster revision
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SolutionListItemResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Roster or revision not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /healthz:
    get:
      operationId: healthCheck
      summary: Health check
      description: Returns 200 if the service is healthy.
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                properties:
                  status:
                    type: string
                    example: ok
        "503":
          description: Service is unhealthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: unhealthy
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    RosterIdParam:
      name: id
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/RosterId"
      description: Unique identifier for the roster.
    RevisionIdParam:
      name: roster_revision
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/RevisionId"
      description: Revision number of the roster.
    SolutionIdParam:
      name: solution_revision
      in: path
      required: true
      schema:
        type: integer
        format: int32
      description: Unique identifier for the solution within the roster revision.
    PageParam:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number for pagination (1-indexed).
    SizeParam:
      name: size
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 30
      description: Number of results per page.
    SortOrderParam:
      name: sortOrder
      in: query
      required: false
      schema:
        type: string
        enum: [asc, desc]
        default: desc
      description: Sort order. Use 'asc' for ascending or 'desc' for descending.
  schemas:
    # --- Common Types ---
    RosterId:
      type: string
      format: uuid
      description: Unique identifier for the roster.
    RevisionId:
      type: integer
      format: int32
      description: Revision number.
    PersonId:
      type: string
      minLength: 1
      maxLength: 50
      description: Unique identifier for a person.
    ShiftId:
      type: string
      minLength: 1
      maxLength: 50
      description: Unique identifier for a shift.
    GroupId:
      type: string
      minLength: 1
      maxLength: 50
      description: Unique identifier for a group.

    RosterSubmission:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: The name of the roster.
    RosterRevisionSubmission:
      type: object
      required:
        - parameters
      properties:
        parameters:
          $ref: "#/components/schemas/RosterParameters"
    RosterParameters:
      type: object
      # Note that no fields are required here as the client can send a work-in-progress
      # roster that will only be partially filled out.
      properties:
        people:
          type: array
          maxItems: 30
          items:
            $ref: "#/components/schemas/Person"
          description: All people in the roster.
        num_days:
          type: integer
          minimum: 1
          maximum: 99
          description: The number of days to schedule.
        start_date:
          type: string
          format: date
          description: The start date of the schedule.
        people_per_shift_override:
          type: array
          description: List of per-date shift staffing requirements.
          maxItems: 99
          items:
            $ref: "#/components/schemas/PeoplePerShiftOverrideEntry"
        people_per_shift_default:
          type: array
          description: Default number of people for each shift if not specified for a date.
          maxItems: 10
          items:
            $ref: "#/components/schemas/PeoplePerShiftDefaultEntry"
        shifts:
          type: array
          maxItems: 10
          items:
            $ref: "#/components/schemas/Shift"
          description: The shifts in a day.
        balance_overtime:
          type: boolean
          description: |
            Whether to balance overtime hours across people. Requires shift_hours to be specified.
            Cannot be used with balance_total_shifts.
        unavailable_slots:
          type: array
          description: List of unavailability entries for people by shift and date.
          maxItems: 30
          items:
            $ref: "#/components/schemas/UnavailableSlotEntry"
        leave_days:
          type: array
          description: List of leave entries by person.
          maxItems: 30
          items:
            $ref: "#/components/schemas/LeaveDaysEntry"
        known_assignments:
          type: array
          description: List of known assignment entries.
          maxItems: 30
          items:
            $ref: "#/components/schemas/KnownAssignmentEntry"
        shift_hours:
          type: array
          description: Per-shift hours configuration by day-of-week or default.
          maxItems: 10
          items:
            $ref: "#/components/schemas/ShiftHoursEntry"
        regular_hours:
          type: array
          description: Default regular hours per day-of-week or default.
          # At most 7 weekdays + 1 'default'
          maxItems: 8
          items:
            $ref: "#/components/schemas/RegularHoursEntry"
        override_regular_hours:
          type: array
          description: Per-date overrides for regular hours.
          maxItems: 99
          items:
            $ref: "#/components/schemas/OverrideRegularHoursEntry"
        override_shift_hours:
          type: array
          description: Per-date per-shift overrides for hours.
          # Up to (num_days * shifts) entries.
          maxItems: 990 # 99 days * 10 shifts
          items:
            $ref: "#/components/schemas/OverrideShiftHoursEntry"
        overtime_multiplier:
          type: number
          minimum: 0
          maximum: 10.0
          description: Multiplier for overtime hours.
        minimum_days_post_shift:
          type: integer
          minimum: 0
          maximum: 30
          description: The minimum number of days a person must have off after doing a shift.
        minimum_golden_weekends:
          type: integer
          minimum: 0
          maximum: 52
          description: Minimum number of golden weekends (weekends with no shifts) a person should have.
        maximum_golden_weekends:
          type: integer
          minimum: 0
          maximum: 52
          description: Maximum number of golden weekends (weekends with no shifts) a person can have. If 0, no maximum is enforced.
        balance_total_shifts:
          type: boolean
          description: Whether to balance total shifts (shift count) across people. Cannot be used with balance_overtime.
        balance_weekend_shifts:
          type: boolean
          description: Whether to balance weekend shifts.
        post_call:
          type: array
          description: Post-call eligibility per shift.
          maxItems: 10
          items:
            $ref: "#/components/schemas/PostCallEntry"
        minimum_overtime_hours:
          type: integer
          minimum: 0
          maximum: 2000
          description: Minimum overtime hours a person should work.
        minimum_regular_hours:
          type: integer
          minimum: 0
          maximum: 5000
          description: Minimum regular hours a person should work.
        groups:
          type: array
          maxItems: 30
          items:
            $ref: "#/components/schemas/Group"
          description: All groups in the roster.
        group_members:
          type: array
          description: Group membership entries; used to prevent group members from working the same day.
          maxItems: 30
          items:
            $ref: "#/components/schemas/GroupMembersEntry"
        restrict_groups_overlap_per_weekday:
          type: array
          maxItems: 7
          items:
            $ref: "#/components/schemas/DayOfWeek"
          description: List of days of the week for which to restrict group overlap.
        groups_unavailable_slots:
          type: array
          description: Unavailability entries for groups by shift and date.
          maxItems: 30
          items:
            $ref: "#/components/schemas/GroupsUnavailableSlotsEntry"
        minimum_shifts_per_person:
          type: array
          description: Minimum shifts per person. If not specified for a person, defaults to 0.
          maxItems: 30
          items:
            $ref: "#/components/schemas/MinimumShiftsPerPersonEntry"
        maximum_shifts_per_person:
          type: array
          description: Maximum shifts per person. If not specified for a person, there is no maximum.
          maxItems: 30
          items:
            $ref: "#/components/schemas/MaximumShiftsPerPersonEntry"
        groups_allowed_days:
          type: array
          description: Allowed working dates per group.
          maxItems: 30
          items:
            $ref: "#/components/schemas/GroupsAllowedDaysEntry"
        maximum_shifts:
          type: integer
          minimum: 0
          maximum: 366
          description: Maximum number of shifts that can be assigned to any person.
        golden_weekends_ignore_leave:
          type: boolean
          description: Whether to ignore leave days when calculating golden weekends.
    RosterCreatedResponse:
      type: object
      required:
        - id
        - roster_revision
      properties:
        id:
          $ref: "#/components/schemas/RosterId"
        roster_revision:
          $ref: "#/components/schemas/RevisionId"
    RosterResponse:
      type: object
      required:
        - id
        - name
        - createdAt
      properties:
        id:
          $ref: "#/components/schemas/RosterId"
        name:
          type: string
          description: The name of the roster.
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the roster was created.
    Metadata:
      type: object
      required:
        - total_count
        - page_total
      properties:
        total_count:
          type: integer
          format: int32
          description: Total number of items matching the query.
        page_total:
          type: integer
          format: int32
          description: Total number of pages available for the given page size.
    RosterListResponse:
      type: object
      required:
        - metadata
        - rosters
      properties:
        metadata:
          $ref: "#/components/schemas/Metadata"
        rosters:
          type: array
          items:
            $ref: "#/components/schemas/RosterResponse"
    RosterRevisionCreatedResponse:
      type: object
      required:
        - roster_revision
      properties:
        roster_revision:
          $ref: "#/components/schemas/RevisionId"
    RosterRevisionResponse:
      type: object
      required:
        - roster_id
        - roster_revision
        - parameters
        - createdAt
      properties:
        roster_id:
          $ref: "#/components/schemas/RosterId"
        roster_revision:
          $ref: "#/components/schemas/RevisionId"
        parameters:
          $ref: "#/components/schemas/RosterParameters"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the roster revision was created.
    RosterRevisionsListResponse:
      type: object
      required:
        - roster_id
        - roster_name
        - revisions
        - metadata
      properties:
        roster_id:
          $ref: "#/components/schemas/RosterId"
        roster_name:
          type: string
          description: The name of the roster.
        revisions:
          type: array
          # TODO: keep in sync with server-side pagination/page size defaults.
          maxItems: 100
          items:
            $ref: "#/components/schemas/RosterRevisionSummary"
        metadata:
          $ref: "#/components/schemas/Metadata"
    RosterRevisionSummary:
      type: object
      required:
        - roster_revision
        - createdAt
      properties:
        roster_revision:
          $ref: "#/components/schemas/RevisionId"
        createdAt:
          type: string
          format: date-time
          minLength: 1
          maxLength: 40
          description: Timestamp when the roster revision was created.
    ErrorResponse:
      type: object
      required:
        - summary
      properties:
        summary:
          type: string
          minLength: 1
          maxLength: 100
          description: Short error summary
        details:
          type: string
          minLength: 1
          maxLength: 1000
          description: Error details
    FieldChangeChangeType:
      type: string
      description: The type of change that will be applied to the field.
      enum:
        - modified
        - removed
    FieldChange:
      type: object
      required:
        - field
        - change_type
        - description
      properties:
        field:
          type: string
          minLength: 1
          maxLength: 100
          description: The name of the field that will be changed (e.g., "unavailable_slots", "known_assignments").
        change_type:
          $ref: "#/components/schemas/FieldChangeChangeType"
        description:
          type: string
          minLength: 1
          maxLength: 500
          description: |
            Human-readable description of what will change.
            Examples:
            - "Removed references to person 'dr. smith' from unavailable_slots"
            - "Removed dates outside range 2025-06-01 to 2025-06-30 from known_assignments"
            - "Removed references to shift 'night' from shift_hours"
        details:
          type: object
          description: Optional structured details about the change for programmatic processing.
          additionalProperties: true
    ValidateRevisionResponse:
      type: object
      required:
        - changes
        - parameters
      properties:
        changes:
          type: array
          description: List of fields that will be modified as a result of the requested changes.
          maxItems: 50
          items:
            $ref: "#/components/schemas/FieldChange"
        parameters:
          $ref: "#/components/schemas/RosterParameters"
    Hours:
      type: object
      required:
        - regular
        - overtime
      properties:
        regular:
          type: integer
          minimum: 0
          maximum: 24
        overtime:
          type: integer
          minimum: 0
          maximum: 24
    PeoplePerShiftOverrideShiftRequirement:
      type: object
      required: [shift_id, required_people]
      properties:
        shift_id:
          $ref: "#/components/schemas/ShiftId"
        required_people:
          type: integer
          minimum: 0
          maximum: 100
          description: Number of people required for the shift on the date.
    PeoplePerShiftOverrideEntry:
      type: object
      required: [date, shifts]
      properties:
        date:
          type: string
          format: date
          description: The date (YYYY-MM-DD) for which overrides apply.
        shifts:
          type: array
          description: Per-shift required people for this date.
          maxItems: 10
          items:
            $ref: "#/components/schemas/PeoplePerShiftOverrideShiftRequirement"
    PeoplePerShiftDefaultEntry:
      type: object
      required: [shift_id, required_people]
      properties:
        shift_id:
          $ref: "#/components/schemas/ShiftId"
        required_people:
          type: integer
          minimum: 0
          maximum: 100
          description: Default number of people required for the shift.
    UnavailableSlotEntry:
      type: object
      required: [person_id, shift_dates]
      properties:
        person_id:
          $ref: "#/components/schemas/PersonId"
        shift_dates:
          type: array
          maxItems: 10
          items:
            $ref: "#/components/schemas/ShiftDates"
          description: Array of shifts and their dates when the person is unavailable.
    LeaveDaysEntry:
      type: object
      required: [person_id, dates]
      properties:
        person_id:
          $ref: "#/components/schemas/PersonId"
        dates:
          type: array
          maxItems: 99
          items:
            type: string
            format: date
    ShiftDates:
      type: object
      required: [shift_id, dates]
      properties:
        shift_id:
          $ref: "#/components/schemas/ShiftId"
        dates:
          type: array
          maxItems: 99
          items:
            type: string
            format: date
          description: Dates for this shift.
    KnownAssignmentEntry:
      type: object
      required: [person_id, shift_dates]
      properties:
        person_id:
          $ref: "#/components/schemas/PersonId"
        shift_dates:
          type: array
          maxItems: 10
          items:
            $ref: "#/components/schemas/ShiftDates"
          description: Array of shifts and their dates for this person.
    DayHoursEntry:
      type: object
      required: [day, hours]
      properties:
        day:
          $ref: "#/components/schemas/DayOfWeekOrDefault"
        hours:
          $ref: "#/components/schemas/Hours"
    ShiftHoursEntry:
      type: object
      required: [shift_id, by_day]
      properties:
        shift_id:
          $ref: "#/components/schemas/ShiftId"
        by_day:
          type: array
          description: Hours per day-of-week or default.
          # At most 7 weekdays + 1 'default'
          maxItems: 8
          items:
            $ref: "#/components/schemas/DayHoursEntry"
    RegularHoursEntry:
      type: object
      required: [day, hours]
      properties:
        day:
          $ref: "#/components/schemas/DayOfWeekOrDefault"
        hours:
          type: integer
          minimum: 0
          maximum: 24
    DayOfWeek:
      type: string
      description: Day-of-week value.
      enum: [monday, tuesday, wednesday, thursday, friday, saturday, sunday]
    DayOfWeekOrDefault:
      type: string
      description: Day-of-week value or 'default'.
      enum:
        [
          monday,
          tuesday,
          wednesday,
          thursday,
          friday,
          saturday,
          sunday,
          default,
        ]
    OverrideRegularHoursEntry:
      type: object
      required: [date, hours]
      properties:
        date:
          type: string
          format: date
        hours:
          type: integer
          minimum: 0
          maximum: 24
    OverrideShiftHoursEntry:
      type: object
      required: [date, shift_id, hours]
      properties:
        date:
          type: string
          format: date
        shift_id:
          $ref: "#/components/schemas/ShiftId"
        hours:
          $ref: "#/components/schemas/Hours"
    PostCallEntry:
      type: object
      required: [shift_id, post_call]
      properties:
        shift_id:
          $ref: "#/components/schemas/ShiftId"
        post_call:
          type: boolean
    GroupMembersEntry:
      type: object
      required: [group_id, person_ids]
      properties:
        group_id:
          $ref: "#/components/schemas/GroupId"
        person_ids:
          type: array
          maxItems: 30
          items:
            $ref: "#/components/schemas/PersonId"
    GroupsUnavailableSlotsEntry:
      type: object
      required: [group_id, shift_dates]
      properties:
        group_id:
          $ref: "#/components/schemas/GroupId"
        shift_dates:
          type: array
          maxItems: 10
          items:
            $ref: "#/components/schemas/ShiftDates"
          description: Array of shifts and their dates when the group is unavailable.
    MinimumShiftsPerPersonEntry:
      type: object
      required: [person_id, min_shifts]
      properties:
        person_id:
          $ref: "#/components/schemas/PersonId"
        min_shifts:
          type: integer
          minimum: 0
          maximum: 366
    MaximumShiftsPerPersonEntry:
      type: object
      required: [person_id, max_shifts]
      properties:
        person_id:
          $ref: "#/components/schemas/PersonId"
        max_shifts:
          type: integer
          minimum: 0
          maximum: 366
    GroupsAllowedDaysEntry:
      type: object
      required: [group_id, dates]
      properties:
        group_id:
          $ref: "#/components/schemas/GroupId"
        dates:
          type: array
          maxItems: 99
          items:
            type: string
            format: date
    Person:
      type: object
      required:
        - id
        - name
      properties:
        id:
          $ref: "#/components/schemas/PersonId"
        name:
          type: string
          minLength: 1
          maxLength: 50
          description: The name of the person.
    Shift:
      type: object
      required:
        - id
        - name
      properties:
        id:
          $ref: "#/components/schemas/ShiftId"
        name:
          type: string
          minLength: 1
          maxLength: 50
          description: The name of the shift.
    Group:
      type: object
      required:
        - id
        - name
      properties:
        id:
          $ref: "#/components/schemas/GroupId"
        name:
          type: string
          minLength: 1
          maxLength: 50
          description: The name of the group.
    SolutionType:
      type: string
      description: The type of solution, defining how it was solved.
      enum:
        - automatic
        - manual
    SolveState:
      type: string
      description: The lifecycle state of a solution.
      enum:
        - pending
        - solving
        - completed
        - failed
    SolveOutcome:
      type: string
      description: The outcome of an automatically solved solution once completed.
      enum:
        - feasible
        - infeasible
        - error
        - timed_out
    SolveError:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Human-readable description of the error that prevented solving.
    SolutionUpdate:
      discriminator:
        propertyName: type
        mapping:
          manual: "#/components/schemas/ManualSolutionUpdate"
          automatic: "#/components/schemas/AutomaticSolutionUpdate"
      oneOf:
        - $ref: "#/components/schemas/ManualSolutionUpdate"
        - $ref: "#/components/schemas/AutomaticSolutionUpdate"
    ManualSolutionSubmission:
      type: object
      required:
        - type
        - solution
      properties:
        type:
          allOf:
            - $ref: "#/components/schemas/SolutionType"
          enum: [manual]
        solution:
          $ref: "#/components/schemas/Solution"
    ManualSolutionUpdate:
      type: object
      required:
        - type
        - solution
      properties:
        type:
          allOf:
            - $ref: "#/components/schemas/SolutionType"
          enum: [manual]
        solution:
          $ref: "#/components/schemas/Solution"
    AutomaticSolutionUpdate:
      type: object
      required:
        - type
        - solve_state
      properties:
        type:
          allOf:
            - $ref: "#/components/schemas/SolutionType"
          enum: [automatic]
        solve_state:
          $ref: "#/components/schemas/SolveState"
        solve_outcome:
          $ref: "#/components/schemas/SolveOutcome"
        solve_error:
          $ref: "#/components/schemas/SolveError"
        solution:
          $ref: "#/components/schemas/Solution"
    Solution:
      type: object
      properties:
        assignments:
          type: array
          # Derived from (max num_days * max shifts * max people) = 99 * 10 * 30 = 29700.
          # TODO: revisit if business rules allow >1 assignment per person per day/shift.
          maxItems: 30000
          items:
            $ref: "#/components/schemas/Assignment"
      required: [assignments]
    Assignment:
      type: object
      required: [personId, dayIndex, shiftId]
      properties:
        personId:
          $ref: "#/components/schemas/PersonId"
        dayIndex:
          type: integer
          minimum: 0
          maximum: 365
        shiftId:
          $ref: "#/components/schemas/ShiftId"
    SolutionCreatedResponse:
      type: object
      required:
        - id
        - type
        - solve_state
        - locked
      properties:
        id:
          type: integer
          format: int32
          description: Unique identifier for the created solution.
        type:
          $ref: "#/components/schemas/SolutionType"
        solve_state:
          $ref: "#/components/schemas/SolveState"
        locked:
          type: boolean
          description: Indicates whether the solution is locked for editing.
    SolutionResponse:
      type: object
      required:
        - id
        - roster_id
        - roster_revision
        - type
        - solve_state
        - createdAt
        - locked
        - has_parameters_snapshot
      properties:
        id:
          type: integer
          format: int32
          description: Solution ID scoped to this roster revision. Each revision has its own sequence of solution IDs starting from 1.
        roster_id:
          $ref: "#/components/schemas/RosterId"
        roster_revision:
          $ref: "#/components/schemas/RevisionId"
        type:
          $ref: "#/components/schemas/SolutionType"
        solve_state:
          $ref: "#/components/schemas/SolveState"
        solve_outcome:
          $ref: "#/components/schemas/SolveOutcome"
        solve_error:
          $ref: "#/components/schemas/SolveError"
        solution:
          $ref: "#/components/schemas/Solution"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the solution was created.
        locked:
          type: boolean
          description: Indicates whether the solution is locked for editing.
        has_parameters_snapshot:
          type: boolean
          description: Indicates whether a snapshot of the roster parameters is stored for this solution (true for all automatic solutions).

    SolutionParametersResponse:
      type: object
      required:
        - id
        - roster_id
        - roster_revision
        - parameters
        - capturedAt
      properties:
        id:
          type: integer
          format: int32
          description: Solution ID scoped to this roster revision.
        roster_id:
          $ref: "#/components/schemas/RosterId"
        roster_revision:
          $ref: "#/components/schemas/RevisionId"
        parameters:
          $ref: "#/components/schemas/RosterParameters"
        capturedAt:
          type: string
          format: date-time
          description: Timestamp when the parameters snapshot was captured for this solution.
    SolutionListItemResponse:
      type: object
      required:
        - id
        - roster_id
        - roster_revision
        - type
        - solve_state
        - createdAt
        - locked
      properties:
        id:
          type: integer
          format: int32
          description: Solution ID scoped to this roster revision. Each revision has its own sequence of solution IDs starting from 1.
        roster_id:
          $ref: "#/components/schemas/RosterId"
        roster_revision:
          $ref: "#/components/schemas/RevisionId"
        type:
          $ref: "#/components/schemas/SolutionType"
        solve_state:
          $ref: "#/components/schemas/SolveState"
        solve_outcome:
          $ref: "#/components/schemas/SolveOutcome"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the solution was created.
        locked:
          type: boolean
          description: Indicates whether the solution is locked for editing.
